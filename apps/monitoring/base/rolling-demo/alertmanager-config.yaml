apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: slack-alert-config
  namespace: rolling-demo-ns
spec:
  route:
    groupBy:
      - pod
    matchers:
      - name: alert_route
        matchType: "="
        value: slack
    receiver: slack-receiver
    repeatInterval: 4h
  receivers:
    - name: slack-receiver
      slackConfigs:
        - apiURL:
            name: webhook-secret
            key: webhook-url
          sendResolved: true
          httpConfig:
            followRedirects: true
          title: '{{ if eq .Status "firing" }}[FIRING]{{ else }}[RESOLVED]{{ end }} {{ .CommonLabels.alertname }}'
          text: >-
            {{ range .Alerts }}

            {{ if eq $.Status "firing" }}ğŸ”´ *[FIRING] {{ .Labels.alertname }}*{{ else }}âœ… *[RESOLVED] {{ .Labels.alertname }}*{{ end }}

            â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

            *Severity:*  {{ if eq .Labels.severity "critical" }}ğŸ”¥ critical{{ else }}âš ï¸ warning{{ end }}

            *Namespace:*  `{{ .Labels.namespace }}`

            {{ if .Labels.pod }}*Pod:*  `{{ .Labels.pod }}`{{ end }}

            *Summary*

            {{ .Annotations.summary }}

            *Description*

            {{ .Annotations.description }}

            {{ end }}
